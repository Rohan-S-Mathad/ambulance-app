"use strict";
/** @module @twilio-labs/serverless-api/dist/api */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getLog = exports.listOnePageLogResources = exports.listLogResources = void 0;
const debug_1 = __importDefault(require("debug"));
const pagination_1 = require("./utils/pagination");
const error_1 = require("../utils/error");
const log = (0, debug_1.default)('twilio-serverless-api:logs');
/**
 * Calls the API to retrieve a list of all assets
 *
 * @param {Sid} environmentSid environment in which to get logs
 * @param {Sid} serviceSid service to look for logs
 * @param {TwilioServerlessApiClient} client API client
 * @returns {Promise<LogApiResource[]>}
 */
async function listLogResources(environmentSid, serviceSid, client) {
    try {
        return (0, pagination_1.getPaginatedResource)(client, `Services/${serviceSid}/Environments/${environmentSid}/Logs`);
    }
    catch (err) {
        log('%O', new error_1.ClientApiError(err));
        throw err;
    }
}
exports.listLogResources = listLogResources;
/**
 * Calls the API to retrieve a list of all assets
 *
 * @param {Sid} environmentSid environment in which to get logs
 * @param {Sid} serviceSid service to look for logs
 * @param {TwilioServerlessApiClient} client API client
 * @returns {Promise<LogApiResource[]>}
 */
async function listOnePageLogResources(environmentSid, serviceSid, client, filters) {
    const pageSize = filters.pageSize || 50;
    const { functionSid, startDate, endDate, pageToken } = filters;
    try {
        let url = `Services/${serviceSid}/Environments/${environmentSid}/Logs?PageSize=${pageSize}`;
        if (typeof functionSid !== 'undefined') {
            url += `&FunctionSid=${functionSid}`;
        }
        if (typeof startDate !== 'undefined') {
            url += `&StartDate=${startDate instanceof Date ? startDate.toISOString() : startDate}`;
        }
        if (typeof endDate !== 'undefined') {
            url += `&EndDate=${endDate instanceof Date ? endDate.toISOString() : endDate}`;
        }
        if (typeof pageToken !== 'undefined') {
            url += `&PageToken=${pageToken}`;
        }
        const resp = await client.request('get', url);
        const content = resp.body;
        return content.logs;
    }
    catch (err) {
        log('%O', new error_1.ClientApiError(err));
        throw err;
    }
}
exports.listOnePageLogResources = listOnePageLogResources;
/**
 * Calls the API to retrieve a list of all assets
 *
 * @param {Sid} logSid SID of log to retrieve
 * @param {Sid} environmentSid environment in which to get logs
 * @param {Sid} serviceSid service to look for logs
 * @param {TwilioServerlessApiClient} client API client
 * @returns {Promise<LogApiResource>}
 */
async function getLog(logSid, environmentSid, serviceSid, client) {
    try {
        const resp = await client.request('get', `Services/${serviceSid}/Environments/${environmentSid}/Logs/${logSid}`);
        return resp.body;
    }
    catch (err) {
        log('%O', new error_1.ClientApiError(err));
        throw err;
    }
}
exports.getLog = getLog;
