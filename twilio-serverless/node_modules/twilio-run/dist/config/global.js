"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.readSpecializedConfig = exports.EXCLUDED_FLAGS = void 0;
const configLoader_1 = require("./utils/configLoader");
exports.EXCLUDED_FLAGS = [
    'username',
    'password',
    'config',
    'key',
    'value',
    'show-values',
];
function readSpecializedConfig(baseDir, configFileName, commandConfigName, opts) {
    const config = (0, configLoader_1.getConfig)(baseDir, configFileName);
    let result = {};
    const { projects: projectsConfig, environments: environmentsConfig, commands: commandConfig, ...baseConfig } = config;
    // take base level config logic
    result = baseConfig;
    // override if command specific config exists
    if (commandConfig === null || commandConfig === void 0 ? void 0 : commandConfig.hasOwnProperty(commandConfigName)) {
        result = {
            ...result,
            ...commandConfig[commandConfigName],
        };
    }
    const environmentValue = typeof (opts === null || opts === void 0 ? void 0 : opts.environmentSuffix) === 'string' &&
        opts.environmentSuffix.length === 0
        ? '*'
        : opts === null || opts === void 0 ? void 0 : opts.environmentSuffix;
    // override if environment config exists
    if (environmentValue &&
        environmentsConfig &&
        environmentsConfig[environmentValue]) {
        result = {
            ...result,
            ...environmentsConfig[environmentValue],
        };
    }
    // override if project specific config exists
    if (opts &&
        opts.username &&
        projectsConfig &&
        (projectsConfig[opts.username] ||
            projectsConfig[`${opts.username}:${opts.region}`])) {
        if (projectsConfig[`${opts.username}:${opts.region}`]) {
            result = {
                ...result,
                ...projectsConfig[`${opts.username}:${opts.region}`],
            };
        }
        else if (opts.region === 'us1' || opts.region === undefined) {
            result = {
                ...result,
                ...projectsConfig[opts.username],
            };
        }
    }
    exports.EXCLUDED_FLAGS.forEach((key) => {
        delete result[key];
    });
    return result;
}
exports.readSpecializedConfig = readSpecializedConfig;
